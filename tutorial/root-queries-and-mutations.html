
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>3. Root queries and mutations Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.2">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="middleware.html" />
    
    
    <link rel="prev" href="define-the-schema.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../tutorial.html">
            
                <a href="../tutorial.html">
            
                    
                    Tutorial
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="define-business-logic.html">
            
                <a href="define-business-logic.html">
            
                    
                    1. Define your business-logic layer
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="define-the-schema.html">
            
                <a href="define-the-schema.html">
            
                    
                    2. Define your schema
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.2.3" data-path="root-queries-and-mutations.html">
            
                <a href="root-queries-and-mutations.html">
            
                    
                    3. Root queries and mutations
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4" data-path="middleware.html">
            
                <a href="middleware.html">
            
                    
                    4. Middleware
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5" data-path="wire-everything-together.html">
            
                <a href="wire-everything-together.html">
            
                    
                    5. Wire everything together
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../data-modeling.html">
            
                <a href="../data-modeling.html">
            
                    
                    Data modeling
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../when-to-use.html">
            
                <a href="../when-to-use.html">
            
                    
                    When to use Micrograph
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../api-reference.html">
            
                <a href="../api-reference.html">
            
                    
                    API
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="../api/compile.html">
            
                <a href="../api/compile.html">
            
                    
                    compile
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="../api/create-middleware.html">
            
                <a href="../api/create-middleware.html">
            
                    
                    createMiddleware
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >3. Root queries and mutations</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="define-some-root-queries-and-mutations">Define some root queries and mutations</h1>
<p>In order to define your root queries and mutations, you need to create a function that maps a <code>cohere</code> type to a series of queries and mutations.</p>
<h2 id="queriesjs"><code>queries.js</code></h2>
<pre><code class="lang-javascript"><span class="hljs-keyword">import</span> { GraphQLNonNull, GraphQLID, GraphQLList } <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;graphql&apos;</span>;

<span class="hljs-comment">// convert user -&gt; User</span>
<span class="hljs-keyword">const</span> titleize = (str) =&gt; <span class="hljs-string">`<span class="hljs-subst">${str[0].toUpperCase()}</span><span class="hljs-subst">${str.slice(1)}</span>`</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> (type) =&gt; ({
  <span class="hljs-comment">// findOneUser and findOneBlog</span>
  [<span class="hljs-string">`findOne<span class="hljs-subst">${titleize(type.name)}</span>`</span>]: {
    description: <span class="hljs-string">`Retrieves a single <span class="hljs-subst">${type.name}</span>`</span>,
    args: { id: { type: <span class="hljs-keyword">new</span> GraphQLNonNull(GraphQLID) } },
    actions: {
      resolve: (args, ctx) =&gt; type.model.findOne(args, ctx).then(data =&gt; ctx.data = data),
      finalize: (args, ctx) =&gt; ctx.data,
      error: (err) =&gt; <span class="hljs-built_in">console</span>.log(err),
    },
  },
  <span class="hljs-comment">// findAllUsers and findAllBlogs</span>
  [<span class="hljs-string">`findAll<span class="hljs-subst">${titleize(type.name)}</span>s`</span>]: {
    description: <span class="hljs-string">`Finds all <span class="hljs-subst">${type.name}</span> types`</span>,
    actions: {
      resolve: (args, ctx) =&gt; type.model.findAll(args, ctx).then(data =&gt; ctx.data = data),
      finalize: (args, ctx) =&gt; ctx.data,
      error: (err) =&gt; <span class="hljs-built_in">console</span>.log(err),
    },
  },
});
</code></pre>
<p>Every type defined in <code>schema.js</code> is mapped to the following queries: <strong>fetchUser</strong>, <strong>fetchBlog</strong>, <strong>findUsers</strong>, and <strong>findBlogs</strong>. Micrograph expects the exported function to return an object whose keys are the root query names and whose values are an object with optional <code>description</code>, <code>args</code>, and <code>output</code> keys. The fourth key <code>actions</code> has a required <code>resolve</code> key and optional <code>finalize</code> and <code>error</code> keys.</p>
<ol>
<li><code>description</code> is the GraphQL description</li>
<li><code>args</code> is a valid GraphQL args object</li>
<li><code>output</code> is a valid GraphQL wrapper (like GraphQLList) or a function that takes in a GraphQL object type and returns an output type, i.e. <code>output: (type) =&gt; new GraphQLList(type)</code></li>
<li><code>actions</code> is an object of methods used for resolving, preparing responses, and handling errors<ol>
<li><code>resolve</code> is the method (located in the middle of the middleware chain) that handles data fetching</li>
<li><code>finalize</code> is the method that transforms <code>ctx</code> into an object that matches the output type</li>
<li><code>error</code> is error handler</li>
</ol>
</li>
</ol>
<h2 id="mutationsjs"><code>mutations.js</code></h2>
<pre><code class="lang-javascript"><span class="hljs-keyword">import</span> { GraphQLInputObjectType, GraphQLID, GraphQLNonNull } <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;graphql&apos;</span>;
<span class="hljs-keyword">let</span> inputObjectCache = {};

<span class="hljs-comment">// convert user -&gt; User</span>
<span class="hljs-keyword">const</span> titleize = (str) =&gt; <span class="hljs-string">`<span class="hljs-subst">${str[0].toUpperCase()}</span><span class="hljs-subst">${str.slice(1)}</span>`</span>;

<span class="hljs-comment">// map a type to a GraphQLInputObjectType</span>
<span class="hljs-keyword">const</span> createInputObject = (type) =&gt; {
  <span class="hljs-keyword">if</span> (inputObjectCache.hasOwnProperty(type.name)) <span class="hljs-keyword">return</span> inputObjectCache[type.name];

  <span class="hljs-keyword">const</span> inputObject = <span class="hljs-keyword">new</span> GraphQLInputObjectType({
    <span class="hljs-comment">// BlogInput and UserInput</span>
    name: <span class="hljs-string">`<span class="hljs-subst">${titleize(type.name)}</span>Input`</span>,
    fields: () =&gt; type.attributes.reduce((accumulator, { field, type }) =&gt; ({
      ...accumulator,
      [field]: { type },
    }), {}),
  });

  inputObjectCache[type.name] = inputObject;
  <span class="hljs-keyword">return</span> inputObject;
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> (type) =&gt; ({
  <span class="hljs-comment">// createUser and createBlog</span>
  [<span class="hljs-string">`create<span class="hljs-subst">${titleize(type.name)}</span>`</span>]: {
    description: <span class="hljs-string">`Creates a <span class="hljs-subst">${type.name}</span>`</span>,
    args: {
      input: { type: createInputObject(type) },
    },
    actions: {
      resolve: (args, ctx) =&gt; type.model.create(args, ctx).then(data =&gt; ctx.data = data),
      finalize: (args, ctx) =&gt; ctx.data
    },
  },
  <span class="hljs-comment">// updateUser and updateBlog</span>
  [<span class="hljs-string">`update<span class="hljs-subst">${titleize(type.name)}</span>`</span>]: {
    description: <span class="hljs-string">`Updates a <span class="hljs-subst">${type.name}</span>`</span>,
    args: {
      input: { type: createInputObject(type) },
      id: { type: <span class="hljs-keyword">new</span> GraphQLNonNull(GraphQLID) },
    },
    actions: {
      resolve: (args, ctx) =&gt; type.model.update(args, ctx).then(data =&gt; ctx.data = data),
      finalize: (args, ctx) =&gt; ctx.data,
    },
  },
});
</code></pre>
<p>Every type defined in <code>schema.js</code> is mapped to the following mutations: <strong>createUser</strong>, <strong>updateUser</strong>, <strong>createBlog</strong>, and <strong>updateBlog</strong>. The <code>createInputObject</code> function in the example maps a type&apos;s attributes into a GraphQL input object type, which is passed into <code>args.input</code>. <code>inputObjectCache</code> in the example is required so that multiple input object types of the same name are not created, otherwise GraphQL will throw an error.</p>
<p>The <code>queries.js</code> and <code>mutations.js</code> files are probably the most complex files in an entire Micrograph application, but they only need to be written once. They will rarely change, and your application can continue to grow by creating more types in <code>schema.js</code>.</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="define-the-schema.html" class="navigation navigation-prev " aria-label="Previous page: 2. Define your schema">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="middleware.html" class="navigation navigation-next " aria-label="Next page: 4. Middleware">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"3. Root queries and mutations","level":"1.2.3","depth":2,"next":{"title":"4. Middleware","level":"1.2.4","depth":2,"path":"tutorial/middleware.md","ref":"tutorial/middleware.md","articles":[]},"previous":{"title":"2. Define your schema","level":"1.2.2","depth":2,"path":"tutorial/define-the-schema.md","ref":"tutorial/define-the-schema.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":[],"pluginsConfig":{"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"tutorial/root-queries-and-mutations.md","mtime":"2016-12-07T02:07:14.000Z","type":"markdown"},"gitbook":{"version":"3.2.2","time":"2016-12-07T19:05:39.616Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

